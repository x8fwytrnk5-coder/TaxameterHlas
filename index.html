<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ZiskoMeter â€“ Taxi efektivita</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color: #fff;
}

header {
  padding: 15px;
  text-align: center;
  background: rgba(0,0,0,0.4);
  font-size: 22px;
  font-weight: bold;
}

.container {
  padding: 15px;
}

.section {
  background: rgba(255,255,255,0.08);
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 15px;
}

label {
  display: block;
  font-size: 14px;
  margin-bottom: 4px;
  opacity: 0.9;
}

input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  margin-bottom: 10px;
  font-size: 16px;
}

.buttons {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

button {
  flex: 1;
  padding: 12px;
  font-size: 15px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: #00c6ff;
  color: #000;
  font-weight: bold;
}

button.secondary {
  background: #ffc107;
}

button.danger {
  background: #ff4d4d;
  color: #fff;
}

#map {
  height: 260px;
  border-radius: 12px;
  margin-top: 10px;
}

.result {
  font-size: 18px;
  font-weight: bold;
  margin-top: 8px;
}

.green { color: #00ff99; }
.red { color: #ff6666; }

footer {
  text-align: center;
  font-size: 12px;
  opacity: 0.6;
  padding: 10px;
}
</style>
</head>

<body>

<header>ğŸš• ZiskoMeter</header>

<div class="container">

  <!-- ADRESY -->
  <div class="section">
    <label for="vehicleAddress">Poloha vozidla</label>
    <input id="vehicleAddress" placeholder="Automaticky z GPS alebo ruÄne">

    <label for="pickup">Miesto nÃ¡stupu klienta</label>
    <input id="pickup" placeholder="Zadaj nÃ¡stup klienta">

    <label for="dropoff">CieÄ¾ klienta</label>
    <input id="dropoff" placeholder="Zadaj cieÄ¾ klienta">

    <label for="priceList">Cena z cennÃ­ka (â‚¬)</label>
    <input id="priceList" type="number" placeholder="Cena podÄ¾a cennÃ­ka">

    <div class="buttons">
      <button onclick="locateVehicle()">ğŸ“ Poloha vozidla</button>
      <button class="secondary" onclick="calculate()">ğŸ“ VypoÄÃ­taÅ¥ trasu</button>
    </div>
  </div>

  <!-- MAPA -->
  <div class="section">
    <div id="map"></div>
  </div>

  <!-- VÃSLEDKY -->
  <div class="section">
    <div id="output" class="result"></div>
  </div>

  <!-- JAZDA -->
  <div class="section">
    <div class="buttons">
      <button onclick="startRide()">â–¶ï¸ ZaÄaÅ¥ jazdu</button>
      <button onclick="startWaiting()">â±ï¸ ÄŒakanie</button>
      <button class="danger" onclick="endRide()">â¹ï¸ UkonÄiÅ¥ jazdu</button>
    </div>
  </div>

  <!-- Å TATISTIKY -->
  <div class="section">
    <div id="stats"></div>
    <button class="danger" onclick="resetStats()">ğŸ—‘ï¸ ZmazaÅ¥ Å¡tatistiky</button>
  </div>

</div>

<footer>
Â© Peter LukÃ¡Ä â€“ ZiskoMeter
</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
let map = L.map('map').setView([48.7,19.1], 8);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let stats = {
  kmToClient: 0,
  kmWithClient: 0,
  cost: 0,
  revenue: 0
};

const rateToClient = 0.31;
const rateWithClient = 0.85;

async function geocode(addr){
  let r = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`);
  let d = await r.json();
  if(!d.length) throw "Adresa nenÃ¡jdenÃ¡";
  return [parseFloat(d[0].lat), parseFloat(d[0].lon)];
}

function distance(a,b){
  const R=6371;
  let dLat=(b[0]-a[0])*Math.PI/180;
  let dLon=(b[1]-a[1])*Math.PI/180;
  let x=Math.sin(dLat/2)**2+Math.cos(a[0]*Math.PI/180)*Math.cos(b[0]*Math.PI/180)*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

async function calculate(){
  try{
    let v = await geocode(vehicleAddress.value);
    let p = await geocode(pickup.value);
    let d = await geocode(dropoff.value);

    let km1 = distance(v,p);
    let km2 = distance(p,d);

    let cost = km1*rateToClient + km2*rateWithClient;
    let revenue = Number(priceList.value||0);
    let profit = revenue - cost;

    stats.kmToClient += km1;
    stats.kmWithClient += km2;
    stats.cost += cost;
    stats.revenue += revenue;

    output.innerHTML = `
      Po klienta: ${km1.toFixed(1)} km<br>
      S klientom: ${km2.toFixed(1)} km<br>
      NÃ¡klady: ${cost.toFixed(2)} â‚¬<br>
      Zisk / strata: <span class="${profit>=0?'green':'red'}">${profit.toFixed(2)} â‚¬</span>
    `;

    updateStats();

    map.eachLayer(l=>{ if(l instanceof L.Marker) map.removeLayer(l); });
    L.marker(v).addTo(map);
    L.marker(p).addTo(map);
    L.marker(d).addTo(map);
    map.fitBounds([v,p,d]);

  }catch(e){ alert(e); }
}

function updateStats(){
  let totalKm = stats.kmToClient + stats.kmWithClient;
  let profit = stats.revenue - stats.cost;
  statsDiv = document.getElementById("stats");
  statsDiv.innerHTML = `
    ğŸš— Km po klienta: ${stats.kmToClient.toFixed(1)}<br>
    ğŸ‘¤ Km s klientom: ${stats.kmWithClient.toFixed(1)}<br>
    ğŸ“ Km spolu: ${totalKm.toFixed(1)}<br>
    ğŸ’° Zisk spolu: ${profit.toFixed(2)} â‚¬
  `;
}

function resetStats(){
  stats = {kmToClient:0,kmWithClient:0,cost:0,revenue:0};
  updateStats();
}

function locateVehicle(){
  navigator.geolocation.getCurrentPosition(pos=>{
    vehicleAddress.value = pos.coords.latitude.toFixed(5)+","+pos.coords.longitude.toFixed(5);
  },()=>alert("GPS nedostupnÃ©"));
}

function startRide(){ alert("Jazda spustenÃ¡"); }
function startWaiting(){ alert("ÄŒakanie spustenÃ©"); }
function endRide(){ alert("Jazda ukonÄenÃ¡"); }
</script>

</body>
</html>
