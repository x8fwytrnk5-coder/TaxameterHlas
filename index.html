function endRide(){
  if(!currentRide) return alert("Jazda nebola začatá");
  currentRide.endTime=new Date();
  currentRide.diff=currentRide.price-currentRide.cost;
  // Výpočet trvania jazdy v minútach
  currentRide.duration=((currentRide.endTime-currentRide.startTime)/60000).toFixed(2);
  
  let rides=JSON.parse(localStorage.getItem("rides")||"[]");
  rides.push(currentRide);
  localStorage.setItem("rides",JSON.stringify(rides));
  currentRide=null;
  alert("Jazda ukončená a uložená");
}

function showStats(){
  let rides=JSON.parse(localStorage.getItem("rides")||"[]");
  if(!rides.length){ alert("Žiadne jazdy"); return; }
  let totalKmTo=0,totalKmWith=0,totalCost=0,totalPrice=0,totalDiff=0,totalTime=0;
  rides.forEach(r=>{
    totalKmTo+=Number(r.kmTo)||0;
    totalKmWith+=Number(r.kmWith)||0;
    totalCost+=Number(r.cost)||0;
    totalPrice+=Number(r.price)||0;
    totalDiff+=Number(r.diff)||0;
    totalTime+=Number(r.duration)||0; // minúty
  });
  let totalKm=totalKmTo+totalKmWith;
  let realValuePerKm=totalKmWith? (totalPrice/totalKmWith).toFixed(2):0;

  alert(`Počet jázd: ${rides.length}
Km po klienta: ${totalKmTo.toFixed(2)}
Km s klientom: ${totalKmWith.toFixed(2)}
Celkové km: ${totalKm.toFixed(2)}
Náklady: ${totalCost.toFixed(2)} €
Cena z cenníka: ${totalPrice.toFixed(2)} €
Celkový zisk/strata: ${totalDiff.toFixed(2)} €
Celkový čas jazdy: ${totalTime.toFixed(2)} min
Reálna hodnota 1 km: ${realValuePerKm} €/km`);
}
