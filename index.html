<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!--
Taxi aplik√°cia ‚Äì kalkulaƒçka n√°kladov / taxameter
Autor my≈°lienky a realiz√°cie: Peter Luk√°ƒç
Rok: 2025

Tento softv√©r je chr√°nen√Ω autorsk√Ωm pr√°vom.
Ak√©koƒævek kop√≠rovanie, ≈°√≠renie alebo pou≈æitie bez s√∫hlasu autora je zak√°zan√©.
-->

<title>Taxi Kalkulaƒçka</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
  background:#f4f6f8;
  margin:0;
  padding:15px;
}
.container{
  max-width:700px;
  margin:auto;
  background:#fff;
  padding:15px;
  border-radius:10px;
}
h1{text-align:center;}
label{font-weight:600;margin-top:10px;display:block;}
input,button{
  width:100%;
  padding:10px;
  margin-top:5px;
  font-size:16px;
}
button{
  background:#007aff;
  color:#fff;
  border:none;
  border-radius:6px;
}
#map{
  height:300px;
  margin-top:15px;
  border-radius:8px;
}
.result{
  margin-top:15px;
  padding:12px;
  border-radius:6px;
  font-size:16px;
}
footer{
  margin-top:25px;
  text-align:center;
  font-size:13px;
  color:#666;
}
</style>
</head>

<body>
<div class="container">
<h1>üöï Taxi Kalkulaƒçka</h1>

<label>Poloha vozidla</label>
<input id="carPos" placeholder="Naƒç√≠tava sa GPS‚Ä¶" readonly>

<label>Miesto n√°stupu klienta</label>
<input id="pickup" placeholder="Zadaj adresu">

<label>Cieƒæ klienta</label>
<input id="dropoff" placeholder="Zadaj adresu">

<label>Cena z cenn√≠ka (‚Ç¨)</label>
<input id="price" type="number" placeholder="Zad√° vodiƒç">

<button onclick="calculate()">Vypoƒç√≠ta≈•</button>

<div id="map"></div>
<div id="result" class="result">V√Ωsledok sa zobraz√≠ tu</div>

<footer>
¬© 2025 ‚Äì Autor: <strong>Peter‚ÄØLuk√°ƒç</strong><br>
Pou≈æitie len so s√∫hlasom autora
</footer>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/*
Taxi aplik√°cia
Autor: Peter Luk√°ƒç
Rok: 2025
*/

/* SKRYT√â SADZBY */
const COST_PER_KM = 0.31;
const RIDE_PER_KM = 0.85;

/* MAPA */
let map = L.map('map').setView([48.1486,17.1077],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'¬© OpenStreetMap'
}).addTo(map);

let markers=[];

/* POLA VOZIDLA */
let carLocation = null;

/* REVERSE GEOCODING */
async function reverseGeocode(lat, lon){
  const r = await fetch(
    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
  );
  const d = await r.json();
  return d.display_name || `${lat.toFixed(5)}, ${lon.toFixed(5)}`;
}

/* GPS */
navigator.geolocation.getCurrentPosition(async pos=>{
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;

  carLocation = { lat, lon };

  const address = await reverseGeocode(lat, lon);
  document.getElementById("carPos").value = address;

  map.setView([lat, lon], 14);
  markers.push(
    L.marker([lat, lon]).addTo(map).bindPopup("Vozidlo")
  );
});

/* GEOK√ìDOVANIE ADRESY */
async function geocode(addr){
  const r=await fetch("https://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(addr));
  const d=await r.json();
  return d.length?{lat:+d[0].lat,lon:+d[0].lon}:null;
}

/* VZDIALENOS≈§ */
async function distance(a,b){
  const r=await fetch(`https://router.project-osrm.org/route/v1/driving/${a.lon},${a.lat};${b.lon},${b.lat}?overview=false`);
  const d=await r.json();
  return d.routes[0].distance/1000;
}

/* V√ùPOƒåET */
async function calculate(){
  const result=document.getElementById("result");
  result.textContent="Poƒç√≠tam‚Ä¶";

  try{
    markers.forEach(m=>map.removeLayer(m));
    markers=[];

    const pickupAddr=document.getElementById("pickup").value;
    const dropAddr=document.getElementById("dropoff").value;
    const price=parseFloat(document.getElementById("price").value);

    if(!pickupAddr||!dropAddr||isNaN(price)){
      result.textContent="Vypl≈à v≈°etky √∫daje";
      return;
    }

    if(!carLocation){
      result.textContent="GPS poloha nie je dostupn√°";
      return;
    }

    const carLoc = carLocation;
    const pick = await geocode(pickupAddr);
    const drop = await geocode(dropAddr);

    if(!pick||!drop){
      result.textContent="Adresu sa nepodarilo n√°js≈•";
      return;
    }

    markers.push(L.marker([carLoc.lat,carLoc.lon]).addTo(map).bindPopup("Vozidlo"));
    markers.push(L.marker([pick.lat,pick.lon]).addTo(map).bindPopup("N√°stup"));
    markers.push(L.marker([drop.lat,drop.lon]).addTo(map).bindPopup("Cieƒæ"));

    const d1 = await distance(carLoc,pick);
    const d2 = await distance(pick,drop);

    const costs = (d1+d2)*COST_PER_KM;
    const ride = d2*RIDE_PER_KM;
    const diff = price-costs;

    result.innerHTML=
      `Cena jazdy: ${price.toFixed(2)} ‚Ç¨<br>
       N√°klady: ${costs.toFixed(2)} ‚Ç¨<br>
       V√Ωsledok: <strong style="color:${diff>=0?'green':'red'}">
       ${diff>=0?'Zisk':'Strata'} ${Math.abs(diff).toFixed(2)} ‚Ç¨</strong>`;
  }catch(e){
    result.textContent="Chyba v√Ωpoƒçtu";
    console.error(e);
  }
}
</script>
</body>
</html>
