<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZiskoMeter</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #0f2027;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color: white;
}

header {
  padding: 16px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}

.container {
  padding: 15px;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

button {
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}

.btn {
  width: 100%;
  margin-bottom: 8px;
  background: #ffcc00;
  color: #000;
  font-weight: bold;
}

.btn-row {
  display: flex;
  gap: 8px;
}

.btn-row button {
  flex: 1;
}

#map {
  height: 300px;
  margin-top: 10px;
  border-radius: 10px;
}

.result {
  margin-top: 10px;
  font-size: 18px;
  font-weight: bold;
}
</style>
</head>

<body>

<header>ğŸš– ZiskoMeter</header>

<div class="container">

<button class="btn" onclick="getGPS()">ğŸ“ UrÄiÅ¥ polohu vozidla</button>

<input id="pickup" placeholder="Miesto nÃ¡stupu klienta">
<input id="dropoff" placeholder="CieÄ¾ klienta">

<button class="btn" onclick="calculate()">ğŸ“ VypoÄÃ­taÅ¥ trasu</button>

<div class="btn-row">
  <button onclick="navToClient()">ğŸš— ZaÄaÅ¥ jazdu</button>
  <button onclick="navClientRoute()">ğŸ‘¤ Klient</button>
</div>

<div class="result" id="output"></div>

<div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map, carMarker, pickupMarker, dropMarker;
let carLat, carLon, pickupLat, pickupLon, dropLat, dropLon;

map = L.map('map').setView([48.15,17.11], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

// GPS vozidla
function getGPS(){
  navigator.geolocation.getCurrentPosition(pos=>{
    carLat = pos.coords.latitude;
    carLon = pos.coords.longitude;
    if(carMarker) map.removeLayer(carMarker);
    carMarker = L.marker([carLat,carLon]).addTo(map).bindPopup("Vozidlo").openPopup();
    map.setView([carLat,carLon],14);
  },()=>alert("GPS sa nepodarilo naÄÃ­taÅ¥"));
}

// geokÃ³dovanie
async function geocode(addr){
  const r = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`);
  const d = await r.json();
  if(!d[0]) throw "Adresa nenÃ¡jdenÃ¡";
  return {lat:+d[0].lat, lon:+d[0].lon};
}

// vÃ½poÄet
async function calculate(){
  try{
    const p = await geocode(pickup.value);
    const d = await geocode(dropoff.value);

    pickupLat=p.lat; pickupLon=p.lon;
    dropLat=d.lat; dropLon=d.lon;

    if(pickupMarker) map.removeLayer(pickupMarker);
    if(dropMarker) map.removeLayer(dropMarker);

    pickupMarker = L.marker([pickupLat,pickupLon]).addTo(map).bindPopup("NÃ¡stup");
    dropMarker = L.marker([dropLat,dropLon]).addTo(map).bindPopup("CieÄ¾");

    map.fitBounds([[pickupLat,pickupLon],[dropLat,dropLon]]);

    output.innerHTML = "Trasa pripravenÃ¡ âœ”ï¸";

  }catch(e){
    alert("Chyba vÃ½poÄtu trasy");
  }
}

// ğŸš— vozidlo â†’ nÃ¡stup
function navToClient(){
  if(!pickupLat) return alert("ChÃ½ba miesto nÃ¡stupu");
  window.open(
    `https://www.google.com/maps/dir/?api=1&destination=${pickupLat},${pickupLon}&travelmode=driving`
  );
}

// ğŸ‘¤ nÃ¡stup â†’ cieÄ¾
function navClientRoute(){
  if(!pickupLat || !dropLat) return alert("Trasa nie je kompletnÃ¡");
  window.open(
    `https://www.google.com/maps/dir/?api=1&origin=${pickupLat},${pickupLon}&destination=${dropLat},${dropLon}&travelmode=driving`
  );
}
</script>

</body>
</html>
