<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZiskoMeter</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:linear-gradient(135deg,#141e30,#243b55);
  color:#fff;
}
header{
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:700;
  background:rgba(0,0,0,0.4);
}
.container{padding:15px}
.section{
  background:rgba(255,255,255,0.08);
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
}
label{
  font-size:14px;
  opacity:.9;
  display:block;
  margin-bottom:4px;
}
input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  font-size:16px;
  margin-bottom:6px;
}
button{
  padding:12px;
  border-radius:12px;
  border:none;
  font-weight:700;
  font-size:15px;
  background:#00c6ff;
  color:#000;
}
.buttons{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.suggestions{
  background:#fff;
  color:#000;
  border-radius:10px;
  max-height:180px;
  overflow-y:auto;
}
.suggestions div{
  padding:8px;
  border-bottom:1px solid #ddd;
}
.suggestions div:hover{background:#eee}
#map{
  height:240px;
  border-radius:14px;
}
.green{color:#00ff99}
.orange{color:#ffcc00}
.red{color:#ff6b6b}
.big{
  font-size:20px;
  font-weight:700;
}
footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  padding:10px;
}
</style>
</head>

<body>

<header>ğŸš• ZiskoMeter â€“ rozhodni za vodiÄa</header>

<div class="container">

<div class="section">
<label>Poloha vozidla</label>
<input id="vehicle" placeholder="GPS alebo ruÄne" oninput="suggest('vehicle','vs')">
<div id="vs" class="suggestions"></div>

<label>NÃ¡stup klienta</label>
<input id="pickup" placeholder="Zadaj nÃ¡stup" oninput="suggest('pickup','ps')">
<div id="ps" class="suggestions"></div>

<label>CieÄ¾ klienta</label>
<input id="dropoff" placeholder="Zadaj cieÄ¾" oninput="suggest('dropoff','ds')">
<div id="ds" class="suggestions"></div>

<label>Cena z cennÃ­ka (â‚¬)</label>
<input id="price" type="number">

<div class="buttons">
<button onclick="locate()">ğŸ“ Poloha</button>
<button onclick="calculate()">ğŸ“ VypoÄÃ­taÅ¥</button>
</div>
</div>

<div class="section">
<div id="map"></div>
</div>

<div class="section" id="output"></div>

</div>

<footer>Â© Peter LukÃ¡Ä â€“ ZiskoMeter</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
const RATE_TO_CLIENT = 0.31;
const RATE_WITH_CLIENT = 0.85;
const MARGIN = 1.20;

let map=L.map("map").setView([48.7,19.1],8);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

async function suggest(id,box){
  let q=document.getElementById(id).value;
  if(q.length<3)return;
  let r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=5&q=${encodeURIComponent(q)}`);
  let d=await r.json();
  let b=document.getElementById(box); b.innerHTML="";
  d.forEach(i=>{
    let div=document.createElement("div");
    div.textContent=i.display_name;
    div.onclick=()=>{document.getElementById(id).value=i.display_name;b.innerHTML=""};
    b.appendChild(div);
  });
}

function locate(){
navigator.geolocation.getCurrentPosition(async p=>{
let r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${p.coords.latitude}&lon=${p.coords.longitude}`);
let d=await r.json();
vehicle.value=d.display_name;
});
}

async function geo(a){
let r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}`);
let d=await r.json();
if(!d[0])throw"Adresa nenÃ¡jdenÃ¡";
return[+d[0].lat,+d[0].lon];
}

function dist(a,b){
const R=6371;
let dLat=(b[0]-a[0])*Math.PI/180;
let dLon=(b[1]-a[1])*Math.PI/180;
let x=Math.sin(dLat/2)**2+Math.cos(a[0]*Math.PI/180)*Math.cos(b[0]*Math.PI/180)*Math.sin(dLon/2)**2;
return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

async function calculate(){
try{
let v=await geo(vehicle.value);
let p=await geo(pickup.value);
let d=await geo(dropoff.value);

let km1=dist(v,p);
let km2=dist(p,d);

let cost = km1*RATE_TO_CLIENT + km2*RATE_WITH_CLIENT;
let recommended = cost * MARGIN;
let listed = +price.value || 0;

let verdict="", cls="", extra="";

if(listed >= recommended){
  verdict="ğŸŸ¢ JAZDU PRIJMI";
  cls="green";
}else{
  let diff = recommended - listed;
  verdict=`ğŸŸ¡ NAVRHNI PRÃPLATOK +${diff.toFixed(2)} â‚¬`;
  cls="orange";
}

output.innerHTML=`
Po klienta: ${km1.toFixed(1)} km<br>
S klientom: ${km2.toFixed(1)} km<br><br>

NÃKLADY: <b>${cost.toFixed(2)} â‚¬</b><br>
DOPORUÄŒENÃ CENA: <b>${recommended.toFixed(2)} â‚¬</b><br>
CENA Z CENNÃKA: <b>${listed.toFixed(2)} â‚¬</b><br><br>

<div class="big ${cls}">${verdict}</div>
`;

map.eachLayer(l=>l instanceof L.Marker&&map.removeLayer(l));
L.marker(v).addTo(map);
L.marker(p).addTo(map);
L.marker(d).addTo(map);
map.fitBounds([v,p,d]);

}catch(e){alert(e)}
}
</script>

</body>
</html>
